<!DOCTYPE html>
<html>
<head>
  <title>–¢—Ä–µ–Ω–∏–Ω–≥–∏</title>
  <meta charset="utf-8">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; }
    .form-group { margin: 10px 0; }
    input, textarea, select { padding: 8px; margin: 5px; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
    button { padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:hover { background: #0056b3; }
    .training { border: 1px solid #ddd; padding: 15px; margin: 10px 0; background: white; border-radius: 4px; }
    .admin-panel { background: #e9ecef; padding: 15px; margin: 15px 0; border-radius: 4px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéì –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏–Ω–≥–æ–≤</h1>
    
    <!-- –ê–¥–º–∏–Ω -->
    <div id="admin" class="admin-panel hidden">
      <h2>üîê –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
      <div class="form-group">
        <input id="title" placeholder="–¢–µ–º–∞"><br>
        <input id="date" type="datetime-local"><br>
        <select id="group">
          <option value="all">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
          <option value="marketing">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
          <option value="sales">–ü—Ä–æ–¥–∞–∂–∏</option>
          <option value="hr">HR</option>
        </select><br>
        <textarea id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea><br>
        <button onclick="addTraining()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏–Ω–≥</button>
      </div>
    </div>
    
    <!-- –õ–æ–≥–∏–Ω -->
    <div id="login">
      <input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
      <button onclick="login()">–í–æ–π—Ç–∏</button>
    </div>
    
    <!-- –°–ø–∏—Å–æ–∫ -->
    <div id="list"></div>

    <script>
      // –¢–í–û–ô NETLIFY URL
      const API_URL = 'https://meek-cobbler-149019.netlify.app/.netlify/functions';
      
      let isAdmin = false;
      
      function login() {
        if (document.getElementById('pass').value === 'admin123') {
          document.getElementById('login').style.display = 'none';
          document.getElementById('admin').classList.remove('hidden');
          isAdmin = true;
          load();
        }
      }
      
      async function load() {
        try {
          const res = await fetch(API_URL + '/getTrainings');
          const data = await res.json();
          
          let html = '';
          data.forEach(t => {
            const date = new Date(t.date).toLocaleString('ru-RU');
            html += `
              <div class="training">
                <h3>${t.title}</h3>
                <p>üìÖ ${date}</p>
                <p>üë• –ì—Ä—É–ø–ø–∞: ${t.group}</p>
                <p>${t.desc}</p>
                <button onclick="register('${t.id}')">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                ${isAdmin ? `<button onclick="del('${t.id}')" style="background:red;">üóë –£–¥–∞–ª–∏—Ç—å</button>` : ''}
                <div style="margin-top:10px;">
                  <strong>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</strong>
                  <ul>
                    ${t.participants.map(p => `<li>${p}</li>`).join('')}
                  </ul>
                </div>
              </div>
            `;
          });
          
          document.getElementById('list').innerHTML = html;
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        }
      }
      
      async function register(id) {
        const name = prompt('–ò–º—è:');
        if (!name) return;
        
        try {
          await fetch(API_URL + '/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              training_id: id,
              name: name
            })
          });
          
          load();
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞:', error);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
        }
      }
      
      async function addTraining() {
        const title = document.getElementById('title').value;
        const date = document.getElementById('date').value;
        const group = document.getElementById('group').value;
        const desc = document.getElementById('desc').value;
        
        if (!title || !date) {
          alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');
          return;
        }
        
        try {
          await fetch(API_URL + '/addTraining', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              id: Date.now().toString(),
              title: title,
              date: date,
              group: group,
              desc: desc
            })
          });
          
          document.getElementById('title').value = '';
          document.getElementById('date').value = '';
          document.getElementById('group').value = 'all';
          document.getElementById('desc').value = '';
          
          load();
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞:', error);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–µ–Ω–∏–Ω–≥–∞');
        }
      }
      
      async function del(id) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å?')) return;
        
        try {
          await fetch(API_URL + '/deleteTraining', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              id: id
            })
          });
          
          load();
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞:', error);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
        }
      }
      
      load();
      setInterval(load, 10000);
    </script>
  </div>
</body>
</html>
